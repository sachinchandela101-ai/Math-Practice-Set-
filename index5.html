<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>मॉक टेस्ट - प्रतिशत (level 5)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; }
    .container { max-width:800px; margin:auto; padding:20px; }
    .card { background:#fff; padding:20px; margin-bottom:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    button { padding:10px 15px; margin:5px; border:none; border-radius:6px; cursor:pointer; transition:0.2s; }
    button:hover{transform:scale(1.02);}
    .btn{background:linear-gradient(90deg,#007bff,#00aaff); color:white;font-weight:bold;}
    .btn-grey{background:linear-gradient(90deg,#666,#999); color:white;}
    .hidden{display:none;}
    .timer{font-size:18px;font-weight:bold;color:#fff;background:linear-gradient(90deg,#ff4b2b,#ff416c);padding:5px 10px;border-radius:8px;display:inline-block;margin-bottom:15px;}
    .tabs{display:flex;justify-content:space-around;margin:15px 0;}
    .tab{flex:1;text-align:center;padding:10px;border-radius:8px;cursor:pointer;font-weight:bold;transition:0.2s;}
    .tab.correct{background:linear-gradient(90deg,#b9fbc0,#22c55e);}
    .tab.incorrect{background:linear-gradient(90deg,#ffb3b3,#ff4d4d);}
    .tab.unattempted{background:linear-gradient(90deg,#cce5ff,#3399ff);}
    .tab.active{border:2px solid #333;}
    .question-card{margin-bottom:15px;border:1px solid #ddd;border-radius:10px;padding:15px;background:#fff;}
    .question-card.correct{border-color:green;}
    .question-card.incorrect{border-color:red;}
    .question-card.unattempted{border-color:#00bfff;}
    .mock-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-weight:bold;font-size:20px;}
    .question-num{position:relative;width:35px;height:35px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;font-weight:bold;transition:0.2s;color:white;}
    .question-num.unattempted{background-color: white; border: 1px solid black; color: black;}
    .question-num.attempted{background-color: #007bff;}
    .question-num.current{background-color: #ff4b2b;}
    .question-num.correct{background-color: #22c55e;}
    .question-num.incorrect{background-color: #ff4d4d;}
    .question-num:hover{transform:scale(1.2);border:2px solid #333;}
    .question-num .tooltip{visibility:hidden;background:#333;color:#fff;text-align:left;padding:5px 8px;border-radius:5px;position:absolute;top:-40px;left:50%;transform:translateX(-50%);z-index:10;white-space:nowrap;font-size:12px;}
    .question-num:hover .tooltip{visibility:visible;}
    #menu-overlay{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;z-index:1000;transition:0.3s;background:rgba(0,0,0,0.5);}
    #menu-overlay.active{opacity:1;pointer-events:auto;}
    #menu-popup{background:#fff;width:600px;max-width:90%;max-height:90%;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.3);display:flex;flex-direction:column;transform:scale(0.7);opacity:0;transition:0.3s ease-in-out;position:relative;}
    #menu-overlay.active #menu-popup{transform:scale(1);opacity:1;}
    #menu-popup h3 { margin-top:0; text-align:center; }
    #menu-popup #close-popup{position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;color:#333;font-weight:bold;}
    #question-numbers{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;overflow-y:auto;flex-grow:1;justify-content:center;}
    #popup-submit,#popup-back{margin-top:10px;padding:12px;font-size:16px;}
    #test-section.blur{filter:blur(5px);transition:0.3s;}
    #lang-toggle{cursor:pointer;font-size:16px;padding:5px 10px;border-radius:6px;border:1px solid #ccc;background:#f0f0f0;}
    @media(max-width:500px){#menu-popup{width:90%;}.question-num{width:30px;height:30px;font-size:14px;}button{font-size:14px;padding:8px 10px;}}
    .option-btn {
        display: block;
        width: 100%;
        text-align: left;
        padding: 12px 15px;
        margin-bottom: 10px;
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        color: #333;
        font-size: 16px;
        border-radius: 8px;
        transition: background-color 0.2s, border-color 0.2s;
    }
    .option-btn:hover { background-color: #e0e0e0; }
    .option-btn.selected { background-color: #007bff; color: white; border-color: #007bff; }
    .option-btn.correct { background-color: #22c55e; color: white; border-color: #22c55e; }
    .option-btn.incorrect { background-color: #ff4d4d; color: white; border-color: #ff4d4d; }
    .question-card pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: inherit;
    }
    #score-summary p {
      margin: 5px 0;
      font-size: 1.1em;
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="mock-header card">
    <div id="mock-title">प्रतिशत मॉक टेस्ट (अगले स्तर का)</div>
    <div style="display:flex;align-items:center;">
      <button id="lang-toggle" class="btn-grey">English</button>
      <div id="menu-toggle" style="margin-left: 10px; cursor:pointer;">&#8942;</div>
    </div>
  </div>

  <div id="menu-overlay">
    <div id="menu-popup">
      <span id="close-popup">&times;</span>
      <h3 id="menu-title">प्रश्न</h3>
      <div id="question-numbers"></div>
      <button id="popup-submit" class="btn">सबमिट करें</button>
      <button id="popup-back" class="btn-grey">वापस जाएँ</button>
    </div>
  </div>
<div id="test-section" class="card">
    <div class="timer" id="timer">समय: 25:00</div>
    <div id="question-container"></div>
    <div id="navigation-buttons" style="display: flex; justify-content: space-between;">
        <button id="prev-btn" class="btn-grey">पिछला प्रश्न</button>
        <button id="next-btn" class="btn">अगला प्रश्न</button>
    </div>
  </div>

  <div id="result-section" class="card hidden">
    <h2>आपका परिणाम</h2>
    <div id="score-summary"></div>
    <div class="tabs">
      <div class="tab correct" id="tab-correct">सही</div>
      <div class="tab incorrect" id="tab-incorrect">गलत</div>
      <div class="tab unattempted" id="tab-unattempted">छोड़े गए</div>
    </div>
    <div id="analysis"></div>
    <canvas id="resultChart" width="300" height="300"></canvas>
  </div>
</div>
<script>
let questions = [
  {
    q_hi: "एक संख्या को पहले 20% बढ़ाया जाता है, फिर 30% कम किया जाता है। यदि अंतिम संख्या 420 है, तो मूल संख्या क्या थी?",
    q_en: "A number is first increased by 20%, then decreased by 30%. If the final number is 420, what was the original number?",
    options: ["450", "500", "525", "600"],
    answer: 1,
    solution_hi: "मान लें कि मूल संख्या N है।\n$N \times (1 + 0.20) \times (1 - 0.30) = 420$।\n$N \times 1.20 \times 0.70 = 420$।\n$N \times 0.84 = 420$।\n$N = 420 / 0.84 = 500$।",
    solution_en: "Let the original number be N. $N \times (1 + 0.20) \times (1 - 0.30) = 420$. $N \times 1.20 \times 0.70 = 420$. $N \times 0.84 = 420$. $N = 420 / 0.84 = 500$."
  },
  {
    q_hi: "एक कक्षा में, 70% छात्र गणित में, 60% अंग्रेजी में और 50% विज्ञान में उत्तीर्ण हुए। 15% तीनों विषयों में उत्तीर्ण हुए, और 5% सभी विषयों में अनुत्तीर्ण हो गए। कितने प्रतिशत छात्र केवल दो विषयों में उत्तीर्ण हुए?",
    q_en: "In a class, 70% of the students passed in Math, 60% in English, and 50% in Science. 15% passed in all three subjects, and 5% failed in all three. What percentage of students passed in exactly two subjects?",
    options: ["40%", "45%", "50%", "55%"],
    answer: 3,
    solution_hi: "कम से कम एक विषय में उत्तीर्ण हुए छात्रों का प्रतिशत = $100\% - 5\% = 95\%$।\nगणित, अंग्रेजी और विज्ञान में उत्तीर्ण हुए छात्रों का योग = $70 + 60 + 50 = 180\%$।\nवेन आरेख सूत्र के अनुसार, तीनों विषयों के योग से 'कम से कम एक' को घटाने पर, 'ठीक दो विषयों' का योग मिलता है।\nकुल उत्तीर्ण = (केवल एक) + (ठीक दो) + (तीनों)।\nविषयों का योग = (केवल एक) + 2(ठीक दो) + 3(तीनों)।\n$95 = (केवल एक) + (ठीक दो) + 15$।\n$180 = (केवल एक) + 2(ठीक दो) + 3 \times 15$।\n$180 = (केवल एक) + 2(ठीक दो) + 45$।\n$(केवल एक) = 135 - 2(ठीक दो)$।\n$95 = (135 - 2(ठीक दो)) + (ठीक दो) + 15$।\n$95 = 150 - (ठीक दो)$।\nठीक दो में उत्तीर्ण = $150 - 95 = 55\%$।",
    solution_en: "Percentage of students who passed in at least one subject = $100\% - 5\% = 95\%$. Sum of students passed in M, E, S = $70 + 60 + 50 = 180\%$. By Venn diagram formula, Sum of individual subjects = Sum(exactly one) + 2 * Sum(exactly two) + 3 * Sum(all three). Total Passed = Sum(exactly one) + Sum(exactly two) + Sum(all three). $180 = Sum(exactly one) + 2 * Sum(exactly two) + 3 * 15$. And $95 = Sum(exactly one) + Sum(exactly two) + 15$. Solving these two equations, we get Sum(exactly two) = 55%."
  },
  {
    q_hi: "एक बर्तन में 3:2 के अनुपात में दूध और पानी का मिश्रण है। 25 लीटर मिश्रण निकालकर उसकी जगह 20 लीटर पानी मिलाया जाता है। दूध और पानी का नया अनुपात 2:3 हो जाता है। मिश्रण की मूल मात्रा क्या थी?",
    q_en: "A vessel contains a mixture of milk and water in the ratio 3:2. 25 liters of the mixture is removed and replaced with 20 liters of water. The new ratio of milk to water becomes 2:3. What was the original quantity of the mixture?",
    options: ["60 लीटर", "65 लीटर", "70 लीटर", "75 लीटर"],
    answer: 1,
    solution_hi: "मान लें कि मूल मात्रा 5x है। दूध = 3x, पानी = 2x।\n25 लीटर मिश्रण निकाला गया: दूध = $25 \times \\frac{3}{5} = 15$ लीटर, पानी = $25 \times \\frac{2}{5} = 10$ लीटर।\nबची हुई मात्रा: दूध = 3x - 15, पानी = 2x - 10।\n20 लीटर पानी मिलाया गया।\nनया दूध = 3x - 15। नया पानी = $(2x - 10) + 20 = 2x + 10$।\n$(3x - 15) / (2x + 10) = 2/3$।\n$3(3x - 15) = 2(2x + 10)$।\n$9x - 45 = 4x + 20$।\n$5x = 65$, $x = 13$।\nमूल मात्रा = $5x = 5 \times 13 = 65$ लीटर।",
    solution_en: "Let the original quantity be 5x. Milk = 3x, Water = 2x. 25L of mixture is removed: Milk removed = $25 \times \\frac{3}{5} = 15$L, Water removed = $25 \times \\frac{2}{5} = 10$L. Remaining: Milk = 3x - 15, Water = 2x - 10. 20L of water is added. New Milk = 3x - 15. New Water = $(2x - 10) + 20 = 2x + 10$. $(3x - 15) / (2x + 10) = 2/3$. $3(3x - 15) = 2(2x + 10)$. $9x - 45 = 4x + 20$. $5x = 65$, $x = 13$. Original quantity = $5x = 5 \times 13 = 65$ liters."
  },
  {
    q_hi: "एक चुनाव में, दो उम्मीदवार थे। 15% मतदाताओं ने वोट नहीं डाले। 100 वोट अमान्य घोषित किए गए। जीतने वाले उम्मीदवार को मतदाता सूची के कुल वोटों का 45% मिला और वह 250 वोटों से जीता। मतदाता सूची में कुल कितने मतदाता थे?",
    q_en: "In an election, there were two candidates. 15% of the voters did not vote. 100 votes were declared invalid. The winning candidate got 45% of the total votes on the list and won by 250 votes. What was the total number of voters on the list?",
    options: ["2000", "2500", "3000", "3500"],
    answer: 2,
    solution_hi: "मान लें कि कुल मतदाता N हैं।\nडाले गए वोट = $0.85N$।\nवैध वोट = $0.85N - 100$।\nविजेता के वोट = $0.45N$।\nहारने वाले के वोट = (वैध वोट) - (विजेता के वोट) = $(0.85N - 100) - 0.45N = 0.40N - 100$।\nजीत का अंतर = (विजेता) - (हारने वाला) = $(0.45N) - (0.40N - 100) = 0.05N + 100$।\nप्रश्न के अनुसार, $0.05N + 100 = 250$।\n$0.05N = 150$।\n$N = 150 / 0.05 = 3000$।",
    solution_en: "Let total voters be N. Votes cast = $0.85N$. Valid votes = $0.85N - 100$. Winner's votes = $0.45N$. Loser's votes = (Valid votes) - (Winner's votes) = $(0.85N - 100) - 0.45N = 0.40N - 100$. Winning margin = (Winner) - (Loser) = $(0.45N) - (0.40N - 100) = 0.05N + 100$. As per the question, $0.05N + 100 = 250$. $0.05N = 150$. $N = 150 / 0.05 = 3000$."
  },
  {
    q_hi: "एक कॉलेज में, 60% छात्र लड़के हैं। यदि 40% लड़के और 50% लड़कियां छात्रावास में रहती हैं, तो कितने प्रतिशत छात्र छात्रावास में रहते हैं?",
    q_en: "In a college, 60% of the students are boys. If 40% of the boys and 50% of the girls live in a hostel, what percentage of students live in the hostel?",
    options: ["44%", "48%", "52%", "56%"],
    answer: 0,
    solution_hi: "कुल छात्रों को 100 मान लें।\nलड़के = $100 \times 0.60 = 60$।\nलड़कियां = $100 - 60 = 40$।\nछात्रावास में रहने वाले लड़के = $60 \times 0.40 = 24$।\nछात्रावास में रहने वाली लड़कियां = $40 \times 0.50 = 20$।\nकुल छात्र जो छात्रावास में रहते हैं = $24 + 20 = 44$।\nअतः, 44% छात्र छात्रावास में रहते हैं।",
    solution_en: "Let total students be 100. Boys = $100 \times 0.60 = 60$. Girls = $100 - 60 = 40$. Boys who live in hostel = $60 \times 0.40 = 24$. Girls who live in hostel = $40 \times 0.50 = 20$. Total students who live in hostel = $24 + 20 = 44$. Hence, 44% of students live in the hostel."
  },
  {
    q_hi: "एक आदमी अपनी आय का 20% भोजन पर, 15% शिक्षा पर, और 25% किराए पर खर्च करता है। शेष का 50% वह बचत करता है। यदि उसकी बचत ₹9,000 है, तो उसकी आय क्या है?",
    q_en: "A man spends 20% of his income on food, 15% on education, and 25% on rent. He saves 50% of the remaining amount. If his saving is ₹9,000, what is his income?",
    options: ["₹40,000", "₹45,000", "₹50,000", "₹55,000"],
    answer: 1,
    solution_hi: "कुल खर्च = $20\% + 15\% + 25\% = 60\%$।\nशेष राशि = $100\% - 60\% = 40\%$।\nबचत = शेष राशि का $50\%$ = $40\%$ का $50\% = 20\%$।\nयदि आय का $20\% = ₹9,000$ है।\nतो, आय = $(\frac{9000}{20}) \times 100 = 450 \times 100 = ₹45,000$।",
    solution_en: "Total expenditure = $20\% + 15\% + 25\% = 60\%$. Remaining amount = $100\% - 60\% = 40\%$. Savings = $50\%$ of the remaining amount = $50\%$ of $40\% = 20\%$. If $20\%$ of income = ₹9,000. Then, Income = $(\frac{9000}{20}) \times 100 = 450 \times 100 = ₹45,000$."
  },
  {
    q_hi: "किसी वस्तु की कीमत में 20% की वृद्धि होती है, और बिक्री में 15% की कमी होती है। यदि कुल राजस्व में ₹6,000 की वृद्धि होती है, तो मूल कुल राजस्व क्या था?",
    q_en: "The price of an item increases by 20%, and sales decrease by 15%. If the total revenue increases by ₹6,000, what was the original total revenue?",
    options: ["₹2,50,000", "₹2,75,000", "₹3,00,000", "₹3,50,000"],
    answer: 2,
    solution_hi: "कुल राजस्व में प्रतिशत परिवर्तन = $20 - 15 - (\\frac{20 \times 15}{100}) = 5 - 3 = 2\%$।\nमूल राजस्व का $2\% = ₹6,000$।\nमूल राजस्व = $(\\frac{6000}{2}) \times 100 = 3000 \times 100 = ₹3,00,000$।",
    solution_en: "Percentage change in total revenue = $20 - 15 - (\\frac{20 \times 15}{100}) = 5 - 3 = 2\%$. 2% of original revenue = ₹6,000. Original revenue = $(\\frac{6000}{2}) \times 100 = ₹3,00,000$."
  },
  {
    q_hi: "एक व्यक्ति की आय में 20% की वृद्धि होती है और कर की दर 10% से घटकर 8% हो जाती है। उसके द्वारा भुगतान किए गए कर में प्रतिशत परिवर्तन क्या है?",
    q_en: "A person's income increases by 20% and the tax rate decreases from 10% to 8%. What is the percentage change in the tax paid by him?",
    options: ["4% की वृद्धि", "4% की कमी", "8% की वृद्धि", "8% की कमी"],
    answer: 1,
    solution_hi: "मान लें कि मूल आय ₹1000 है।\nमूल कर = ₹1000 का 10% = ₹100।\nनई आय = ₹1000 + 20% = ₹1200।\nनया कर = ₹1200 का 8% = ₹96।\nकर में परिवर्तन = ₹96 - ₹100 = -₹4 (कमी)।\nप्रतिशत परिवर्तन = $(\\frac{-4}{100}) \times 100 = -4\%$।",
    solution_en: "Let original income be ₹1000. Original tax = 10% of ₹1000 = ₹100. New income = ₹1000 + 20% = ₹1200. New tax = 8% of ₹1200 = ₹96. Change in tax = ₹96 - ₹100 = -₹4 (decrease). Percentage change = $(\\frac{-4}{100}) \times 100 = -4\%$."
  },
  {
    q_hi: "एक आदमी की आय में 20% की वृद्धि होती है और उसका खर्च भी 20% बढ़ता है। यदि उसकी बचत ₹5,000 है, तो उसकी आय क्या थी?",
    q_en: "A man's income increases by 20% and his expenditure also increases by 20%. If his saving is ₹5,000, what was his income?",
    options: ["₹20,000", "₹25,000", "₹30,000", "यह निर्धारित नहीं किया जा सकता"],
    answer: 3,
    solution_hi: "मान लें कि मूल आय I, खर्च E और बचत S है। $I = E + S$।\nनई आय = $1.20I$। नया खर्च = $1.20E$।\nनई बचत = (नई आय) - (नया खर्च) = $1.20I - 1.20E = 1.20(I-E) = 1.20S$।\nइसका मतलब है कि बचत भी 20% बढ़ जाती है। प्रश्न में यह स्पष्ट नहीं है कि ₹5,000 नई बचत है या मूल बचत। इसलिए, आय निर्धारित नहीं की जा सकती।",
    solution_en: "Let original income be I, expenditure E and savings S. $I = E + S$. New income = $1.20I$. New expenditure = $1.20E$. New savings = (New income) - (New expenditure) = $1.20I - 1.20E = 1.20(I-E) = 1.20S$. This means the savings also increase by 20%. The question does not specify if ₹5,000 is the new saving or the original saving. Therefore, the income cannot be determined."
  }
];

// The rest of the script is the same as before.
let currentQuestion = 0;
let score = 0;
let lang = "hi";
let answers = new Array(questions.length).fill(null);
let timer;
let timeLeft = 25 * 60; // 25 minutes in seconds

// Elements
const questionContainer = document.getElementById("question-container");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");
const timerEl = document.getElementById("timer");
const resultSection = document.getElementById("result-section");
const scoreSummaryDiv = document.getElementById("score-summary");
const analysisDiv = document.getElementById("analysis");
const ctx = document.getElementById("resultChart").getContext("2d");
const navigationButtons = document.getElementById("navigation-buttons");

// Popup elements
const menuToggle = document.getElementById("menu-toggle");
const menuOverlay = document.getElementById("menu-overlay");
const closePopup = document.getElementById("close-popup");
const testSection = document.getElementById("test-section");
const qNumContainer = document.getElementById("question-numbers");
const popupSubmit = document.getElementById("popup-submit");
const popupBack = document.getElementById("popup-back");

// Tabs
const tabCorrect = document.getElementById("tab-correct");
const tabIncorrect = document.getElementById("tab-incorrect");
const tabUnattempted = document.getElementById("tab-unattempted");
let currentTab = 'correct';

// Language toggle
document.getElementById("lang-toggle").addEventListener("click", ()=>{
  lang = lang === "hi" ? "en" : "hi";
  document.getElementById("lang-toggle").innerText = lang === "hi" ? "English" : "हिंदी";
  document.getElementById("mock-title").innerText = lang === "hi" ? "प्रतिशत मॉक टेस्ट (अगले स्तर का)" : "Percentage Mock Test (Next Level)";
  document.getElementById("menu-title").innerText = lang === "hi" ? "प्रश्न" : "Questions";
  popupSubmit.innerText = lang === "hi" ? "सबमिट करें" : "Submit";
  popupBack.innerText = lang === "hi" ? "वापस जाएँ" : "Back";
  prevBtn.innerText = lang === "hi" ? "पिछला प्रश्न" : "Previous Question";
  nextBtn.innerText = lang === "hi" ? "अगला प्रश्न" : "Next Question";
  if(!resultSection.classList.contains("hidden")){
    tabCorrect.innerText = lang === "hi" ? "सही" : "Correct";
    tabIncorrect.innerText = lang === "hi" ? "गलत" : "Incorrect";
    tabUnattempted.innerText = lang === "hi" ? "छोड़े गए" : "Unattempted";
    showResult(currentTab);
  }
  loadQuestion();
});

// Timer
function startTimer(){
  timer = setInterval(()=>{
    timeLeft--;
    let min = String(Math.floor(timeLeft/60)).padStart(2,"0");
    let sec = String(timeLeft%60).padStart(2,"0");
    timerEl.innerText = `${lang==="hi"?"समय":"Time"}: ${min}:${sec}`;

    if (timeLeft <= 0) {
      clearInterval(timer);
      endTest();
    }
  },1000);
}

// Load Question
function loadQuestion(){
  let q = questions[currentQuestion];
  questionContainer.innerHTML = `
    <div class="question-card">
      <h3>${(currentQuestion+1)}. ${lang==="hi"?q.q_hi:q.q_en}</h3>
      ${q.options.map((opt,i)=>`
        <button class="option-btn ${answers[currentQuestion]===i?"selected":""}" onclick="selectOption(${i})">${opt}</button>
      `).join("")}
    </div>
  `;
  renderQNumbers();
  updateNavigationButtons();
}

// Select Option
function selectOption(i){
  answers[currentQuestion] = i;
  loadQuestion();
}

// Navigation buttons logic
function updateNavigationButtons() {
    if (currentQuestion === 0) {
        prevBtn.style.visibility = 'hidden';
    } else {
        prevBtn.style.visibility = 'visible';
    }

    if (currentQuestion === questions.length - 1) {
        nextBtn.innerText = lang === "hi" ? "टेस्ट सबमिट करें" : "Submit Test";
        nextBtn.classList.remove("btn");
        nextBtn.classList.add("btn-grey");
    } else {
        nextBtn.innerText = lang === "hi" ? "अगला प्रश्न" : "Next Question";
        nextBtn.classList.add("btn");
        nextBtn.classList.remove("btn-grey");
    }
}

prevBtn.addEventListener("click", ()=>{
  if(currentQuestion > 0){
    currentQuestion--;
    loadQuestion();
  }
});

nextBtn.addEventListener("click", ()=>{
  if(currentQuestion < questions.length-1){
    currentQuestion++;
    loadQuestion();
  } else {
    endTest();
  }
});

// End Test
function endTest(){
  clearInterval(timer);
  document.getElementById("test-section").classList.add("hidden");
  resultSection.classList.remove("hidden");
  showResult('correct');
}

// Show Result
function showResult(filter){
  currentTab = filter;
  let correct=0,incorrect=0,unattempted=0;
  questions.forEach((q,i)=>{
    if(answers[i]==null){unattempted++;}
    else if(answers[i]===q.answer){correct++;}
    else{incorrect++;}
  });

  const totalAttempted = correct + incorrect;
  const accuracy = totalAttempted > 0 ? ((correct / totalAttempted) * 100).toFixed(2) : 0;

  scoreSummaryDiv.innerHTML = `
    <p style="font-size:1.2em; font-weight:bold;">${lang==="hi"?"स्कोर":"Score"}: ${correct} / ${questions.length}</p>
    <p>${lang==="hi"?"सही":"Correct"}: <strong>${correct}</strong></p>
    <p>${lang==="hi"?"गलत":"Incorrect"}: <strong>${incorrect}</strong></p>
    <p>${lang==="hi"?"छोड़े गए":"Unattempted"}: <strong>${unattempted}</strong></p>
    <p>${lang==="hi"?"एक्यूरेसी":"Accuracy"}: <strong>${accuracy}%</strong></p>
  `;

  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.getElementById(`tab-${filter}`).classList.add('active');

  analysisDiv.innerHTML = "";
  let filteredQuestions = [];
  if(filter === 'correct'){
    filteredQuestions = questions.filter((q, i) => answers[i] === q.answer);
  } else if (filter === 'incorrect'){
    filteredQuestions = questions.filter((q, i) => answers[i] !== null && answers[i] !== q.answer);
  } else if (filter === 'unattempted'){
    filteredQuestions = questions.filter((q, i) => answers[i] === null);
  }

  filteredQuestions.forEach(q => {
    let qIndex = questions.indexOf(q);
    let isCorrect = answers[qIndex] === q.answer;
    let cardClass = isCorrect ? 'correct' : (answers[qIndex] === null ? 'unattempted' : 'incorrect');

    analysisDiv.innerHTML += `
      <div class="question-card ${cardClass}">
        <h3>${qIndex+1}. ${lang==="hi"?q.q_hi:q.q_en}</h3>
        ${q.options.map((opt,i)=>`
          <button class="option-btn ${i===q.answer?'correct':(i===answers[qIndex]?'incorrect':'')}" disabled>${opt}</button>
        `).join("")}
        <br>
        <div style="font-weight:bold;">${lang==="hi"?"सही उत्तर":"Correct Answer"}: ${q.options[q.answer]}</div>
        <div style="margin-top:10px;">
          <strong>${lang==="hi"?"समाधान":"Solution"}:</strong>
          <pre>${lang==="hi"?q.solution_hi:q.solution_en}</pre>
        </div>
      </div>
    `;
  });
  
  // Clear previous chart and draw new one
  if(window.myChart) {
    window.myChart.destroy();
  }

  window.myChart = new Chart(ctx,{
    type:'pie',
    data:{
      labels:[lang==="hi"?"सही":"Correct",lang==="hi"?"गलत":"Incorrect",lang==="hi"?"छोड़े गए":"Unattempted"],
      datasets:[{
        data:[correct,incorrect,unattempted],
        backgroundColor:['#22c55e','#ff4d4d','#3399ff']
      }]
    },
    options:{responsive:true, maintainAspectRatio:false}
  });
}

// Event listeners for result tabs
tabCorrect.addEventListener("click", () => showResult('correct'));
tabIncorrect.addEventListener("click", () => showResult('incorrect'));
tabUnattempted.addEventListener("click", () => showResult('unattempted'));


// Render Question Numbers inside Popup
function renderQNumbers(){
  qNumContainer.innerHTML = "";
  questions.forEach((q,i)=>{
    let status="unattempted";
    if(answers[i]!=null) status="attempted";
    if(i===currentQuestion) status="current";
    let div = document.createElement("div");
    div.className="question-num "+status;
    div.innerHTML = (i+1);
    div.onclick=()=>{currentQuestion=i; loadQuestion(); closeMenu();};
    qNumContainer.appendChild(div);
  });
}

// Popup toggle
menuToggle.addEventListener("click", ()=>{
  menuOverlay.classList.add("active");
  testSection.classList.add("blur");
  renderQNumbers();
});
closePopup.addEventListener("click", closeMenu);
popupBack.addEventListener("click", closeMenu);
function closeMenu(){
  menuOverlay.classList.remove("active");
  testSection.classList.remove("blur");
}
popupSubmit.addEventListener("click", ()=>{
  closeMenu();
  endTest();
});

// Initial load
startTimer();
loadQuestion();
</script>
</body>
</html>
